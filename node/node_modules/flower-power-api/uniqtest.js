var FlowerPowerCloud = require('./FlowerPowerCloud');
var async = require('async');
var assert = require('assert');

var api = new FlowerPowerCloud();

describe('.login()', function() {
  describe('Invalid credentials', function () {
    it('Not json', function (done) {
      var credentials = "hello";
      api.login(credentials, function(err, res) {
        assert.equal("Data is not a json", err.message);
        done();
      });
    });
    it('Invalid Grant', function (done) {
      var credentials = {
      	'username'		: "---",
      	'password'		: "---",
      	'client_id'		: "parrottest.fpwebservice@gmail.com",
      	'client_secret'	: "cvSjfnONllkHLymF2gEUL73PPXJiMMcVCd1VtZaIXHSGyhaT",
      };
      api.login(credentials, function(err, res) {
        assert.equal(400, err.code);
        assert.equal('invalid_grant', err.errors[0].error);
        done();
      });
    });
    it('Invalid Client', function (done) {
      var credentials = {
      	'username'		: "parrottest.fpwebservice@gmail.com",
      	'password'		: "Parrot2015FP",
      	'client_id'		: "---",
      	'client_secret'	: "---",
      };
      api.login(credentials, function(err, res) {
        assert.equal(400, err.code);
        assert.equal('invalid_client', err.errors[0].error);
        done();
      });
    });
  });
  describe('Valid credentials', function() {
    it('Success', function (done) {
      var credentials = {
        'username'		: "parrottest.fpwebservice@gmail.com",
        'password'		: "Parrot2015FP",
        'client_id'		: "parrottest.fpwebservice@gmail.com",
        'client_secret'	: "cvSjfnONllkHLymF2gEUL73PPXJiMMcVCd1VtZaIXHSGyhaT",
      };
      api.login(credentials, function(err, res) {
        assert(typeof res == 'object');
        assert(typeof res.access_token == 'string');
        assert(typeof res.expires_in == 'number');
        assert(typeof res.refresh_token == 'string');
        done();
      });
    });
  });
});
